#include "../inc/types.h"
#include "../inc/loop.h"

short int **inverse_quantize(short int **block) {
    short int V[6][4][4] = {
        //QP % 6 = 0
        {{10, 13, 10, 13},
         {13, 16, 13, 16},
         {10, 13, 10, 13},
         {13, 16, 13, 16}},
        //QP % 6 = 1
        {{11, 14, 11, 14},
         {14, 18, 14, 18},
         {11, 14, 11, 14},
         {14, 18, 14, 18}},
        //QP % 6 = 2
        {{13, 16, 13, 16},
         {16, 20, 16, 20},
         {13, 16, 13, 16},
         {16, 20, 16, 20}},
        //QP % 6 = 3
        {{14, 18, 14, 18},
         {18, 23, 18, 23},
         {14, 18, 14, 18},
         {18, 23, 18, 23}},
        //QP % 6 = 4
        {{16, 20, 16, 20},
         {20, 25, 20, 25},
         {16, 20, 16, 20},
         {20, 25, 20, 25}},
        //QP % 6 = 5
        {{18, 23, 18, 23},
         {23, 29, 23, 29},
         {18, 23, 18, 23},
         {23, 29, 23, 29}}};

    int i, j;
    short int **iq;

    iq = malloc_matrix(4, 4);

    for (i = 0; i < 4; i++)
        for (j = 0; j < 4; j++)
            iq[i][j] = (block[i][j] * V[QP % 6][i][j]) << (short int) floor(QP / 6);

    return iq;
}